<table class="table table-striped">
  <%= form_tag(refresh_optimizely_path, method: :post) do %>
    <% if current_user.refresh_running? %>
      <div class="alert alert-warning">
        Optimizely scan running now. Refresh this page to see progress.
      </div>
    <% elsif current_user.last_optimizely_updated_at.present? %>
      <div class="alert alert-success">
        Optimizely last scanned <%= distance_of_time_in_words_to_now(current_user.last_optimizely_updated_at) %> ago.
        <br>
        <%= current_user.last_optimizely_status %>
        <%= submit_tag "Re Scan Now", class: "btn btn-primary" %>

      </div>
    <% else %>
      <div class="alert alert-warning">
        Never scanned optimizely account - click "Scan Now" to start
        <%= submit_tag "Scan Now", class: "btn btn-primary" %>
      </div>
    <% end %>
  <% end %>
  <thead>
    <tr>
      <th>Title</th>
      <th>Created / Updated</th>
      <th>Variations</th>
      <th>Currently</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @experiments.each do |experiment| %>
      <tr>
        <td><%= experiment.description %></td>
        <td>
          Created: <%= experiment.optimizely_created_at.strftime('%D') %> <br>
          Last Update: <%= experiment.optimizely_last_updated_at.strftime('%D') %>
        </td>      
        <td>
          <% experiment.variations.each do |v| %>
            <%= image_tag(v.screencap.url(:thumb)) unless v.screencap.blank? %>
          <% end %>
        </td>
        <td><%= experiment.status %></td>
        <td>
          <%= link_to experiment_path(experiment), :class => 'btn btn-xs', :title => "details" do %>
            <%= glyph 'info-sign' %>
          <%- end -%>
          <%= link_to edit_experiment_path(experiment), :class => 'btn btn-xs', :title => "edit" do %>
            <%= glyph 'pencil' %>
          <%- end -%>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
